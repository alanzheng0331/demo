<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¼ä¸šæ³¨å†Œå®¡æŸ¥ - å…¼èŒç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="http://localhost:8080/part_time_system_war_exploded/admin/style.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-logo">æ˜“å…¼èŒâ€”ç®¡ç†å‘˜åå°</div>
        <div class="header-user">
            <span>æ¬¢è¿, ç®¡ç†å‘˜</span>
            <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
    </header>

    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li class="menu-title">å®¡æ ¸ç®¡ç†</li>
                <li><a href="companyReview.html" class="active">
                    <span class="menu-icon">ğŸ¢</span><span>ä¼ä¸šæ³¨å†Œå®¡æŸ¥</span>
                </a></li>
                <li><a href="jobReview.html">
                    <span class="menu-icon">ğŸ’¼</span><span>ä¼ä¸šå…¼èŒå®¡æ ¸</span>
                </a></li>
                <li class="menu-title">è´¦å·ç®¡ç†</li>
                <li><a href="userManagement.html">
                    <span class="menu-icon">ğŸ‘¤</span><span>ç”¨æˆ·è´¦å·ç®¡ç†</span>
                </a></li>
                <li><a href="companyManagement.html">
                    <span class="menu-icon">ğŸ­</span><span>ä¼ä¸šè´¦å·ç®¡ç†</span>
                </a></li>
            </ul>
        </aside>

        <!-- å†…å®¹åŒº -->
        <div class="content">
            <div class="msg-box success-msg" id="successMsg">æ“ä½œæˆåŠŸï¼</div>
            <div class="msg-box error-msg" id="errorMsg">æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•ï¼</div>

            <div class="content-header">
                <h1 class="page-title">ä¼ä¸šæ³¨å†Œå®¡æŸ¥</h1>
                <div>
                    <select class="search-input" id="statusSelect" style="width: auto; margin-right: 10px;">
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="pending">å¾…å®¡æ ¸</option>
                        <option value="approved">å·²é€šè¿‡</option>
                        <option value="rejected">å·²æ‹’ç»</option>
                    </select>
                    <button class="search-btn" onclick="searchEnterprise()">ç­›é€‰</button>
                </div>
            </div>

            <div class="card">
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchKey" placeholder="æœç´¢ä¼ä¸šåç§°/è”ç³»äºº/æ‰‹æœºå·">
                    <button class="search-btn" onclick="searchEnterprise()">æœç´¢</button>
                </div>

                <table class="table-common">
                    <thead>
                        <tr>
                            <th>ç”³è¯·ID</th>
                            <th>ä¼ä¸šåç§°</th>
                            <th>ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç </th>
                            <th>è”ç³»äºº</th>
                            <th>æ‰‹æœºå·</th>
                            <th>ç”³è¯·æ—¶é—´</th>
                            <th>å®¡æ ¸çŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="enterpriseTableBody">
                        <tr>
                            <td>1001</td>
                            <td>åŒ—äº¬ç§‘æŠ€æœ‰é™å…¬å¸</td>
                            <td>91110108MA00000000</td>
                            <td>å¼ ç»ç†</td>
                            <td>138****1234</td>
                            <td>2025-05-20 10:30</td>
                            <td><span class="status-tag status-pending">å¾…å®¡æ ¸</span></td>
                            <td class="btn-group">
                                <button class="btn-small btn-view" onclick="viewEnterprise(1001)">æŸ¥çœ‹</button>
                                <button class="btn-small btn-approve" onclick="reviewEnterprise(1001, 'approved')">é€šè¿‡</button>
                                <button class="btn-small btn-reject" onclick="reviewEnterprise(1001, 'rejected')">æ‹’ç»</button>
                            </td>
                        </tr>
                        <tr>
                            <td>1002</td>
                            <td>ä¸Šæµ·æ–‡åŒ–ä¼ åª’å…¬å¸</td>
                            <td>91310104MA11111111</td>
                            <td>ææ€»ç›‘</td>
                            <td>139****5678</td>
                            <td>2025-05-19 14:20</td>
                            <td><span class="status-tag status-pending">å¾…å®¡æ ¸</span></td>
                            <td class="btn-group">
                                <button class="btn-small btn-view" onclick="viewEnterprise(1002)">æŸ¥çœ‹</button>
                                <button class="btn-small btn-approve" onclick="reviewEnterprise(1002, 'approved')">é€šè¿‡</button>
                                <button class="btn-small btn-reject" onclick="reviewEnterprise(1002, 'rejected')">æ‹’ç»</button>
                            </td>
                        </tr>
                        <tr>
                            <td>1003</td>
                            <td>å¹¿å·è´¸æ˜“æœ‰é™å…¬å¸</td>
                            <td>91440101MA22222222</td>
                            <td>ç‹æ€»</td>
                            <td>137****9012</td>
                            <td>2025-05-18 09:15</td>
                            <td><span class="status-tag status-rejected">å·²æ‹’ç»</span></td>
                            <td class="btn-group">
                                <button class="btn-small btn-view" onclick="viewEnterprise(1003)">æŸ¥çœ‹</button>
                                <button class="btn-small btn-approve" onclick="reviewEnterprise(1003, 'approved')">é€šè¿‡</button>
                                <button class="btn-small btn-reject" disabled style="background: #ccc; cursor: not-allowed;">æ‹’ç»</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="pagination">
                    <a href="javascript:void(0)" class="page-btn" onclick="changePage('prev')">Â«</a>
                    <a href="javascript:void(0)" class="page-btn active" onclick="changePage(1)">1</a>
                    <a href="javascript:void(0)" class="page-btn" onclick="changePage(2)">2</a>
                    <a href="javascript:void(0)" class="page-btn" onclick="changePage('next')">Â»</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¼ä¸šè¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ä¼ä¸šæ³¨å†Œè¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div id="enterpriseDetailContent"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="close-btn" style="background: #f5f7fa; padding: 8px 20px; border-radius: 6px; font-size: 14px;" onclick="closeModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- å®¡æ ¸å¤‡æ³¨å¼¹çª— -->
    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="reviewTitle">å®¡æ ¸å¤„ç†</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <form id="reviewForm" onsubmit="return submitReview()">
                <input type="hidden" id="reviewId" value="">
                <input type="hidden" id="reviewAction" value="">
                <div class="form-group">
                    <label class="form-label" for="reviewRemark">å®¡æ ¸å¤‡æ³¨</label>
                    <textarea class="form-control" id="reviewRemark" rows="4" placeholder="è¯·è¾“å…¥å®¡æ ¸å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰"></textarea>
                </div>
                <button type="submit" class="submit-btn" id="reviewSubmitBtn">ç¡®è®¤å®¡æ ¸</button>
            </form>
        </div>
    </div>

    <script>
        let currentPage = 1;
        const totalPages = 2;

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                window.location.href = 'login.html';
            }
        }

        // æŸ¥çœ‹ä¼ä¸šè¯¦æƒ…
        function viewEnterprise(id) {
            hideMessages();
            const enterpriseData = {
                1001: {
                    name: 'åŒ—äº¬ç§‘æŠ€æœ‰é™å…¬å¸',
                    code: '91110108MA00000000',
                    contact: 'å¼ ç»ç†',
                    phone: '138****1234',
                    email: 'zhang@example.com',
                    address: 'åŒ—äº¬å¸‚æœé˜³åŒºç§‘æŠ€å›­',
                    business: 'æŠ€æœ¯å¼€å‘ã€æŠ€æœ¯æœåŠ¡',
                    time: '2025-05-20 10:30',
                    remark: ''
                },
                1002: {
                    name: 'ä¸Šæµ·æ–‡åŒ–ä¼ åª’å…¬å¸',
                    code: '91310104MA11111111',
                    contact: 'ææ€»ç›‘',
                    phone: '139****5678',
                    email: 'li@example.com',
                    address: 'ä¸Šæµ·å¸‚å¾æ±‡åŒºæ–‡åŒ–è¡—',
                    business: 'æ–‡åŒ–æ´»åŠ¨ç­–åˆ’ã€å¹¿å‘Šåˆ¶ä½œ',
                    time: '2025-05-19 14:20',
                    remark: ''
                },
                1003: {
                    name: 'å¹¿å·è´¸æ˜“æœ‰é™å…¬å¸',
                    code: '91440101MA22222222',
                    contact: 'ç‹æ€»',
                    phone: '137****9012',
                    email: 'wang@example.com',
                    address: 'å¹¿å·å¸‚å¤©æ²³åŒºå•†è´¸ä¸­å¿ƒ',
                    business: 'å›½å†…è´¸æ˜“ã€è´§ç‰©è¿›å‡ºå£',
                    time: '2025-05-18 09:15',
                    remark: 'è¥ä¸šæ‰§ç…§ä¿¡æ¯ä¸å®Œæ•´'
                }
            };

            const data = enterpriseData[id] || {};
            let remarkHtml = data.remark ? `<p><strong>å®¡æ ¸å¤‡æ³¨ï¼š</strong>${data.remark}</p>` : '';
            
            const html = `
                <div style="line-height: 1.8;">
                    <p><strong>ä¼ä¸šåç§°ï¼š</strong>${data.name || 'æœªçŸ¥'}</p>
                    <p><strong>ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š</strong>${data.code || 'æœªçŸ¥'}</p>
                    <p><strong>è”ç³»äººï¼š</strong>${data.contact || 'æœªçŸ¥'}</p>
                    <p><strong>è”ç³»ç”µè¯ï¼š</strong>${data.phone || 'æœªçŸ¥'}</p>
                    <p><strong>ç”µå­é‚®ç®±ï¼š</strong>${data.email || 'æœªçŸ¥'}</p>
                    <p><strong>ä¼ä¸šåœ°å€ï¼š</strong>${data.address || 'æœªçŸ¥'}</p>
                    <p><strong>ç»è¥èŒƒå›´ï¼š</strong>${data.business || 'æœªçŸ¥'}</p>
                    <p><strong>ç”³è¯·æ—¶é—´ï¼š</strong>${data.time || 'æœªçŸ¥'}</p>
                    ${remarkHtml}
                </div>
            `;
            document.getElementById('enterpriseDetailContent').innerHTML = html;
            document.getElementById('detailModal').style.display = 'flex';
        }

        // æ‰“å¼€å®¡æ ¸å¼¹çª—
        function reviewEnterprise(id, action) {
            hideMessages();
            document.getElementById('reviewId').value = id;
            document.getElementById('reviewAction').value = action;
            const actionText = action === 'approved' ? 'é€šè¿‡' : 'æ‹’ç»';
            document.getElementById('reviewTitle').textContent = `å®¡æ ¸${actionText}`;
            document.getElementById('reviewSubmitBtn').textContent = `ç¡®è®¤${actionText}`;
            document.getElementById('reviewRemark').value = '';
            document.getElementById('reviewModal').style.display = 'flex';
        }

        // æäº¤å®¡æ ¸
        function submitReview() {
            const id = document.getElementById('reviewId').value;
            const action = document.getElementById('reviewAction').value;
            const remark = document.getElementById('reviewRemark').value.trim();
            
            const rows = document.querySelectorAll('#enterpriseTableBody tr');
            let updated = false;
            rows.forEach(row => {
                if (row.cells[0].textContent === id) {
                    const statusTag = row.querySelector('.status-tag');
                    const btnGroup = row.querySelector('.btn-group');
                    if (action === 'approved') {
                        statusTag.className = 'status-tag status-approved';
                        statusTag.textContent = 'å·²é€šè¿‡';
                        btnGroup.querySelector('.btn-approve').disabled = true;
                        btnGroup.querySelector('.btn-approve').style.background = '#ccc';
                    } else {
                        statusTag.className = 'status-tag status-rejected';
                        statusTag.textContent = 'å·²æ‹’ç»';
                        btnGroup.querySelector('.btn-reject').disabled = true;
                        btnGroup.querySelector('.btn-reject').style.background = '#ccc';
                    }
                    updated = true;
                }
            });

            closeModal();
            if (updated) {
                showSuccessMessage(`ä¼ä¸šå®¡æ ¸${action === 'approved' ? 'é€šè¿‡' : 'æ‹’ç»'}æˆåŠŸï¼`);
            } else {
                showErrorMessage('å®¡æ ¸æ“ä½œå¤±è´¥ï¼');
            }
            return false;
        }

        // æœç´¢ä¼ä¸š
        function searchEnterprise() {
            hideMessages();
            const key = document.getElementById('searchKey').value.trim().toLowerCase();
            const status = document.getElementById('statusSelect').value;
            const rows = document.querySelectorAll('#enterpriseTableBody tr');
            let hasResult = false;

            rows.forEach(row => {
                const name = row.cells[1].textContent.toLowerCase();
                const contact = row.cells[3].textContent.toLowerCase();
                const phone = row.cells[4].textContent.toLowerCase();
                const rowStatus = row.querySelector('.status-tag').classList.contains('status-pending') ? 'pending' : 
                                  row.querySelector('.status-tag').classList.contains('status-approved') ? 'approved' : 'rejected';
                
                const matchKey = !key || name.includes(key) || contact.includes(key) || phone.includes(key);
                const matchStatus = !status || rowStatus === status;

                if (matchKey && matchStatus) {
                    row.style.display = '';
                    hasResult = true;
                } else {
                    row.style.display = 'none';
                }
            });

            if (!hasResult) {
                const tbody = document.getElementById('enterpriseTableBody');
                if (!tbody.querySelector('#emptyRow')) {
                    tbody.innerHTML += '<tr id="emptyRow"><td colspan="8" style="text-align: center; color: #999;">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä¼ä¸š</td></tr>';
                }
            } else {
                const emptyRow = document.getElementById('emptyRow');
                emptyRow && emptyRow.remove();
            }
        }

        // åˆ†é¡µåˆ‡æ¢
        function changePage(page) {
            if (page === 'prev') currentPage = Math.max(1, currentPage - 1);
            else if (page === 'next') currentPage = Math.min(totalPages, currentPage + 1);
            else currentPage = parseInt(page);
            
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === currentPage.toString()) btn.classList.add('active');
            });
            showSuccessMessage(`å·²åˆ‡æ¢åˆ°ç¬¬${currentPage}é¡µ`);
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
            document.getElementById('reviewModal').style.display = 'none';
        }

        // æç¤ºä¿¡æ¯
        function showSuccessMessage(msg) {
            const success = document.getElementById('successMsg');
            const error = document.getElementById('errorMsg');
            error.style.display = 'none';
            success.textContent = msg;
            success.style.display = 'block';
            setTimeout(() => success.style.display = 'none', 3000);
        }

        function showErrorMessage(msg) {
            const success = document.getElementById('successMsg');
            const error = document.getElementById('errorMsg');
            success.style.display = 'none';
            error.textContent = msg;
            error.style.display = 'block';
            setTimeout(() => error.style.display = 'none', 3000);
        }

        function hideMessages() {
            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
        }
    </script>
</body>
</html>